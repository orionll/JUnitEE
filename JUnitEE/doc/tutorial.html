<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--
	$Id: tutorial.html,v 1.3 2002-08-15 19:44:39 o_rossmueller Exp $
	$Source: C:\Users\Orionll\Desktop\junitee-cvs/JUnitEE/doc/tutorial.html,v $
-->

<html>
	<head>
		<title>JUnitEE</title>

		<link rel="stylesheet" href="stylesheet.css" type="text/css">
	</head>

	<body>
    <table>
      <tr><td colspan="3">
        <table cellspacing="0" cellpadding="0" width="100%">
          <tr> <td class="pageTitle"> JUnitEE </td> </tr>
          <tr> <td align="right"> <small> $Revision: 1.3 $ </small> </td> </tr>
        </table>
      </td></tr>
      <tr><td valign="top" align="left">
        <table width="100%" height="100%" border="0" cellspacing="2" cellpadding="2" class="menuTable">
          <tr><td class="menu"><a class="menu" href="index.html">Home</a></td></tr>
          <tr><td class="menu"><a class="menu" href="news.html">News</a></td></tr>
          <tr><td class="menuSelected"><a class="menuSelected" href="documentation.html">Documentation</a></td></tr>
          <tr><td class="menu"><a class="menu" href="http://sourceforge.net/project/showfiles.php?group_id=31476">Download</a></td></tr>
          <tr><td class="menu"><a class="menu" href="http://sourceforge.net/projects/junitee">Project page</a></td></tr>
          <tr><td class="menu"><a class="menu" href="contact.html">Contact</a></td></tr>
          <tr><td class="menu"><a class="menu" href="http://www.c2.com/cgi/wiki?JunitEe">JUnitEE Wiki</a></td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
          <tr><td>&nbsp;</td></tr>
        </table>
      </td><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td width="100%" valign="top">


		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Tutorial </td> </tr>
		</table>

		<p>
      This tutorial will show you how to use JUnitEE to unit test an
      Enterprise JavaBean. You will write a web-application which contains
      unit test cases and build it into your J2EE application.
		</p>

		<p>
			Before you start, you will need the following software (in addition
			to your app server and the appropriate JDK):
		</p>
		<ul>
			<li> <a href="http://jakarta.apache.org/ant/"> The Ant build system </a> </li>
			<li> <a href="http://www.junit.org/"> The JUnit test framework </a> </li>
			<li> <a href="http://junitee.sourceforge.net/"> The JUnitEE extension to JUnit </a> </li>
		</ul>

    <p>
						<i>
							We assume that you already understand how
							to build and deploy EJBs in your app server and how to write JUnit test cases.
							There are links at the <a href="#refs">bottom</a> of
							this page which may help.
						</i>
    </p>
		<p>
			This tutorial will follow these steps:
		</p>
		<ul>
			<li> <a href="#step1"> Step 1: Prepare the sample EJB </a> </li>
			<li> <a href="#step2"> Step 2: Set up the directory structure </a> </li>
			<li> <a href="#step3"> Step 3: Write the test case </a> </li>
			<li> <a href="#step4"> Step 4: Create the TestServlet</a> </li>
			<li> <a href="#step5"> Step 5: Create the UI form </a> </li>
			<li> <a href="#step6"> Step 6: Create the web.xml deployment descriptor </a> </li>
			<li> <a href="#step7"> Step 7: Package the application</a> </li>
			<li> <a href="#step8"> Step 8: Install application and run </a> </li>
			<li> <a href="#notes"> Notes </a> </li>
			<li> <a href="#refs"> References </a> </li>
			<li> <a href="#todo"> TODO </a> </li>
			<li> <a href="#thanks"> Thanks </a> </li>
		</ul>

		<a name="step1"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 1: Prepare the sample EJB </td> </tr>
		</table>

		<p>
			You will find an example EJB (and test harness) in the <tt>example</tt>
			subdirectory of the JUnitEE install directory.  You should first build this
			example and make sure it works, or, case the case happens to be,
			doesn't work (the sample bean has a bug which causes it to fail its
			test case).  You will most likely need to edit the
			<tt>build.xml</tt> file and update the paths to whatever is appropriate
			for your system.  Then just run "ant" in the same directory as the
			build file.
		</p>

		<p>
			A word about the source layout:  All java files are compiled in a
			single big java tree, then integrated into the various components
			as build steps.  The components (ear, web-war, ejb-jar, etc) are
			located in the <tt>components</tt> subdirectory and mirror the
			actual archive directory structure (minus the java classes and
			other constructed files, of course).
		</p>

		<p>
			The final output of building the example should be a file called
			<tt>junitee-example.ear</tt> in a subdirectory called <tt>out</tt>.
			It will contain a simple stateless
			session EJB, a web application which uses the EJB, and the test web
			application.  This is a standard J2EE enterprise archive and should
			be installable as-is on any J2EE-compliant app server.
		</p>

		<p>
			It is beyond the scope of this article to explain how to install the
			enterprise archive into your application server because the steps are
			different for each vendor.  If you're using
			<a href="http://www.orionserver.com/">Orion</a>, you can find some
			pretty good instructions
			<a href="http://www.jollem.com/orion-primer/">here</a>.  Otherwise you're
			on your own.
		</p>

		<p>
			If you want to write everything by hand, delete the <tt>components/test-war</tt>
			subdirectory in the <tt>example</tt> directory.  The remainder of this
			tutorial is how to build the test.
		</p>

		<a name="step2"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 2: Set up the directory structure </td> </tr>
		</table>

		<p>
			For building a test web application, first we need to set up the
			directory structure.  Create these directories:
		</p>

		<blockquote>
			example/javasrc/org/infohazard/test/ <br>
			example/componens/test-war/ <br>
			example/componens/test-war/WEB-INF/ <br>
		</blockquote>

		<p>
			This example puts test cases in the package "org.infohazard.test".  If
			you want to be able to test package-private methods, you will need to
			put test cases in the same package as the classes they are trying to
			test.  Since most testing should occur at the public interface level,
			you may wish to reconsider doing this.
		</p>

		<a name="step3"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 3: Write the test case </td> </tr>
		</table>

		<p>
			The test case is a standard JUnit TestCase.  For the fixture, you can
			use the default JNDI InitialContext to get a reference to the EJB like
			this:
		</p>

			<pre>
protected void setUp() throws Exception
{
  Context jndiContext = new InitialContext();

  Object einRef = jndiContext.lookup("java:comp/env/ejb/EinsteinEJB");
  EinsteinHome home = 
      (EinsteinHome)PortableRemoteObject.narrow(einRef, EinsteinHome.class);

  this.ein = home.create();
}
			</pre>

		<p>
			And the test methods themselves look like this:
		</p>

			<pre>
public void testSimpleAddition() throws RemoteException
{
	String result = this.ein.addTwoNumbers("7", "10");
	assert(result.equals("17"));
}
			</pre>

		<p>
			This code belongs in: <br>

			<tt>example/javasrc/org/infohazard/test/EinsteinTest.java</tt>.
		</p>

		<a name="step4"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 4: Create the TestServlet</td> </tr>
		</table>

		<p>
			We need to have a servlet to run our test cases.  The <tt>junit.htmlui.TestServletBase</tt> will be sufficent
      for almost all kinds of usage.
    </p>
    <p>
      The important detail is the classloader which will be
      used by the servlet to load your test cases. The default behaviour of the servlet is to use the classloader that 
      loaded the servlet class itself. If this does not work in your situation, you have to subclass <tt>junit.htmlui.TestServletBase</tt>
      and overwrite the <tt>getDynamicClassLoader()</tt> method:
		</p>

			<pre>
protected ClassLoader getDynamicClassLoader()
{
	return getMySpecialClassLoader();
}
			</pre>


		<a name="step5"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 5: Create the UI Form </td> </tr>
		</table>

		<p>
			The TestServlet will execute test cases specified by the "suite"
			form parameter, which can appear multiple times.  It's
			nice to have a simple front end form:
		</p>

			<pre>
&lt;p&gt;
	You may type in the name of a test suite:
	&lt;br/&gt;
	&lt;form action="TestServlet" method="get" name="youTypeItForm"&gt;
		&lt;input type="text" name="suite" size=60 /&gt;
		&lt;input type="submit" value="Run" /&gt;
	&lt;/form&gt;
&lt;/p&gt;
&lt;hr/&gt;
&lt;p&gt;
	You may pick one or more of the following test suites:
	&lt;br/&gt;
	&lt;form action="TestServlet" method="get" name="youPickItForm"&gt;
		&lt;select name="suite" size="2" multiple&gt;
			&lt;option value="org.infohazard.test.EinsteinTest"&gt;
				org.infohazard.test.EinsteinTest
			&lt;/option&gt;
			&lt;option value="some.other.Test"&gt;
				some.other.Test
			&lt;/option&gt;
		&lt;/select&gt;
		&lt;input type="submit" value="Run" /&gt;
	&lt;/form&gt;
&lt;/p&gt;
			</pre>

		<p>
			Save this as <tt>example/components/test-war/index.html</tt>
		</p>

		<a name="step6"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 6: Create the web.xml deployment descriptor </td> </tr>
		</table>

		<p>
			The web application must have a deployment descriptor which provides
			the ejb-ref mapping so that the "java:comp/env/ejb/EinsteinEJB" JNDI
			lookup will work and so that the TestServlet gets mapped to some sort
			of URI.  Here's what the <tt>web.xml</tt> should look like:
		</p>

			<pre>
&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE web-app PUBLIC 
        "-//Sun Microsystems, Inc.//DTD Web Application 2.2//EN" 
        "http://java.sun.com/j2ee/dtds/web-app_2_2.dtd"&gt;

&lt;web-app&gt;
  &lt;display-name&gt; Einstein Unit Tester Web Application &lt;/display-name&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;JUnitEETestServlet&lt;/servlet-name&gt;
    &lt;description&gt;JUnitEE test framework&lt;/description&gt;
    &lt;servlet-class&gt;junit.htmlui.TestServletBase&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;ejb-ref&gt;
    &lt;ejb-ref-name&gt;ejb/EinsteinEJB&lt;/ejb-ref-name&gt;
    &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
    &lt;home&gt;org.infohazard.ejb.einstein.EinsteinHome&lt;/home&gt;
    &lt;remote&gt;org.infohazard.ejb.einstein.Einstein&lt;/remote&gt;
  &lt;/ejb-ref&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;JUnitEETestServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/TestServlet&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;
			</pre>

		<p>
			This should be saved as: <br>
			<tt>example/components/test-war/WEB-INF/web.xml</tt>
		</p>
    <p>
      For the case you implemented your own test servlet class, please be sure to replace <tt>junit.htmlui.TestServletBase</tt>
      in the deployment descriptor with the class name of your own servlet.
    </p>


		<a name="step7"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 7: Package the test WAR</td> </tr>
		</table>

    <p>
    Now you have everything ready to package the test web application. You have to put
    </p>
    <ul>
    <li><tt>junit.jar</tt> and <tt>junitee.jar</tt> to <tt>WEB-INF/lib</tt></li>
    <li>your test classes to <tt>WEB-INF/classes</tt> or a jar containing the test classes to <tt>WEB-INF/lib</tt></li>
    <li>if you implemented your own test servlet, you have to place this class to <tt>WEB-INF/classes</tt>, too</li>
    </ul>
    <p>
    Finally, jar everything into the <tt>test.war</tt>.
    </p>

		<a name="step8"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Step 8: There is no step number 8 </td> </tr>
		</table>

		<p>
			Not acutually true; you still need to add the web-application to the
			application's <tt>application.xml</tt> deployment descriptor, build the
			enterprise archive as described in Step 1, and install the application
			in your app server.  But if you're using the example EJB, the
			<tt>application.xml</tt> should already be set up, and you should already
			know how to do the rest :-)
		</p>

		<p>
			To run your test, just point your web browser at whatever URL you
			mapped the test web application to.
		</p>

		<a name="notes"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Notes </td> </tr>
		</table>

		<p>
			Some things you might want to keep in mind when unit testing EJBs:
		</p>
		<ul>
			<li>
				Unless you (and everyone else on the project) are extremely
				careful writing your unit tests, they are very likely going
				to seriously mess up your database.  You should probably never
				run tests against a production system, and for this (and other
				security reasons) you should not enable the test web application
				on the production machine.
			</li>
			<li>
				The testing of getters and setters is probably a waste of time.
			</li>
		</ul>

		<a name="refs"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> References </td> </tr>
		</table>

		<p>
			Stuff you might find interesting and/or useful:
		</p>

		<ul>
			<li>
				For information about JUnit, you naturally want to visit the
				<a href="http://www.junit.org/">JUnit home page</a>.
			</li>
			<li>
				For an introduction to extreme programming, you should read
				<a href="http://www.extremeprogramming.org/">Extreme Programming: A Gentle Introduction</a>
				and then go to <a href="http://www.xprogramming.com/">XProgramming.com</a>.
			</li>
			<li>
				For information about how to build J2EE applications with the
				<a href="http://www.orionserver.com/">Orion</a> server, try the
				<a href="http://www.jollem.com/orion-primer/">Orion Primer</a>
				by Ernst de Haan.
			</li>
			<li>
				A fantastic resource for patterns, anecdotes, and other useful
				information is the
				<a href="http://www.c2.com/cgi/wiki?WelcomeVisitors">Portland Pattern Repostory</a>.
				You might want to start with the
				<a href="http://www.c2.com/cgi/wiki?EjbUnitTest">EjbUnitTest</a>
				page or the
				<a href="http://www.c2.com/cgi/wiki?JunitEe">JunitEe</a> page.
			</li>
		</ul>

		<a name="todo"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> TODO </td> </tr>
		</table>

		<p>
			Lots.
		</p>

		<a name="thanks"></a>
		<table cellspacing="0" cellpadding="0" width="100%">
			<tr> <td class="sectionTitle"> Thanks </td> </tr>
		</table>

		<p>
		</p>

		<div align="center">
			<table width="90%" border="0" cellspacing="0" cellpadding="1" class="noteTable">
				<tr>
					<td class="noteText">
		<p>
			This tutorial was written by <a href="mailto:jeff@infohazard.org">Jeff Schnitzer</a>
			and edited by <a href="oliver@oross.net">Oliver Rossmueller</a> to reflect the latest changes in JUnitEE.
		</p>
		<p>
			This article was originally developed on a Casio Portatone keyboard running
			BlackKey Linux.  All typos, innacuracies, mistakes, and
			outright lies have been inserted by the FBI computer preprocessing
			all of your email and web downloads.
		</p>
					</td>
				</tr>
			</table>
		</div>

		<table cellspacing="0" cellpadding="0" width="100%">
      <tr><td align="right" valign="middle" colspan="2">&nbsp;</td></tr>
      <tr><td align="right" valign="middle" colspan="2">&nbsp;</td></tr>
      <tr><td align="right" valign="middle" class="footer" colspan="2">&nbsp;</td></tr>
			<tr><td align="right" valign="middle" width="50%">This project is hosted by&nbsp;</td>
      <td align="left" valign="middle" width="50%"><a href="http://sourceforge.net">
				<img src="http://sourceforge.net/sflogo.php?group_id=31476" width="88" height="31" border="0" alt="SourceForge Logo">  
			</a></td></tr>
		</table>

      </td></tr>
    </table>
	</body>
</html>